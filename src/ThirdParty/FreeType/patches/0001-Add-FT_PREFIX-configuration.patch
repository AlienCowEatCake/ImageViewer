From ceaa20de373d71c9d8fae930232bc011dbe4e4f7 Mon Sep 17 00:00:00 2001
From: Peter Zhigalov <peter.zhigalov@gmail.com>
Date: Sat, 24 Aug 2024 05:38:07 +0700
Subject: [PATCH] Add FT_PREFIX configuration

---
 include/freetype/config/ftoption.h | 4 ++--
 include/freetype/internal/ftcalc.h | 2 +-
 include/ft2build.h                 | 4 ++++
 src/base/ftcalc.c                  | 4 +++-
 4 files changed, 10 insertions(+), 4 deletions(-)

diff --git a/include/freetype/config/ftoption.h b/include/freetype/config/ftoption.h
index 4934186..3439b3b 100644
--- a/include/freetype/config/ftoption.h
+++ b/include/freetype/config/ftoption.h
@@ -153,7 +153,7 @@ FT_BEGIN_HEADER
    * that to verify that the assembler function works properly, or to execute
    * benchmark tests of the various implementations.
    */
-/* #define FT_CONFIG_OPTION_NO_ASSEMBLER */
+#define FT_CONFIG_OPTION_NO_ASSEMBLER
 
 
   /**************************************************************************
@@ -165,7 +165,7 @@ FT_BEGIN_HEADER
    * If your compiler is not C99-compliant or CPU assembly is not supported,
    * you can disable this option.
    */
-#define FT_CONFIG_OPTION_INLINE_MULFIX
+/* #define FT_CONFIG_OPTION_INLINE_MULFIX */
 
 
   /**************************************************************************
diff --git a/include/freetype/internal/ftcalc.h b/include/freetype/internal/ftcalc.h
index 16a7322..7a71f08 100644
--- a/include/freetype/internal/ftcalc.h
+++ b/include/freetype/internal/ftcalc.h
@@ -419,7 +419,7 @@ FT_BEGIN_HEADER
 #endif /* !FT_CONFIG_OPTION_NO_ASSEMBLER */
 
 
-#ifndef FT_MSB
+#if !defined (FT_MSB) || defined (FT_MSB_USE_C_IMPL)
 
   FT_BASE( FT_Int )
   FT_MSB( FT_UInt32  z );
diff --git a/include/ft2build.h b/include/ft2build.h
index 3008aea..75b8da0 100644
--- a/include/ft2build.h
+++ b/include/ft2build.h
@@ -34,6 +34,10 @@
 #ifndef FT2BUILD_H_
 #define FT2BUILD_H_
 
+#if defined (FT_PREFIX)
+#include "ftprefix.h"
+#endif
+
 #include <freetype/config/ftheader.h>
 
 #endif /* FT2BUILD_H_ */
diff --git a/src/base/ftcalc.c b/src/base/ftcalc.c
index 7d6e12e..e34b3bd 100644
--- a/src/base/ftcalc.c
+++ b/src/base/ftcalc.c
@@ -39,8 +39,10 @@
 #include <freetype/internal/ftobjs.h>
 
   /* cancel inlining macro from internal/ftcalc.h */
+#ifdef FT_CONFIG_OPTION_INLINE_MULFIX
 #ifdef FT_MulFix
 #  undef FT_MulFix
+#endif
 #endif
 
 
@@ -96,7 +98,7 @@
     return a & ~0xFFFFL;
   }
 
-#ifndef FT_MSB
+#if !defined (FT_MSB) || defined (FT_MSB_USE_C_IMPL)
 
   FT_BASE_DEF( FT_Int )
   FT_MSB( FT_UInt32 z )
-- 
2.51.0

