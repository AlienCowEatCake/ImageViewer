From 063b93babe86b74bae9626bac7e01a8eb13ea2c6 Mon Sep 17 00:00:00 2001
From: Peter Zhigalov <peter.zhigalov@gmail.com>
Date: Wed, 21 Dec 2022 23:23:25 +0700
Subject: [PATCH 2/3] Revert "Enable wide chars for all Windows"

This reverts commit 0d7c5a181905eeb6b5bc2c8f91012a2abb0c5bfc.
---
 libheif/api/libheif/heif_context.cc | 2 +-
 libheif/file.cc                     | 8 ++++----
 libheif/file.h                      | 2 +-
 3 files changed, 6 insertions(+), 6 deletions(-)

diff --git a/libheif/api/libheif/heif_context.cc b/libheif/api/libheif/heif_context.cc
index f0985061..aed62fe3 100644
--- a/libheif/api/libheif/heif_context.cc
+++ b/libheif/api/libheif/heif_context.cc
@@ -234,7 +234,7 @@ static heif_error heif_file_writer_write(heif_context* ctx,
 {
   const char* filename = static_cast<const char*>(userdata);
 
-#if defined(__MINGW32__) || defined(__MINGW64__) || defined(_MSC_VER)
+#ifdef _MSC_VER
   std::ofstream ostr(HeifFile::convert_utf8_path_to_utf16(filename).c_str(), std::ios_base::binary);
 #else
   std::ofstream ostr(filename, std::ios_base::binary);
diff --git a/libheif/file.cc b/libheif/file.cc
index 89d0e8fa..4336146f 100644
--- a/libheif/file.cc
+++ b/libheif/file.cc
@@ -41,13 +41,13 @@
 
 #include "libheif/heif_cxx.h"
 
-#if defined(__MINGW32__) || defined(__MINGW64__) || defined(_MSC_VER)
+#ifdef _MSC_VER
 
 #ifndef NOMINMAX
 #define NOMINMAX 1
 #endif
 
-#include <windows.h>
+#include <Windows.h>
 #endif
 
 
@@ -102,7 +102,7 @@ std::shared_ptr<Box_infe> HeifFile::get_infe_box(heif_item_id ID)
 
 Error HeifFile::read_from_file(const char* input_filename)
 {
-#if defined(__MINGW32__) || defined(__MINGW64__) || defined(_MSC_VER)
+#ifdef _MSC_VER
   auto input_stream_istr = std::unique_ptr<std::istream>(new std::ifstream(convert_utf8_path_to_utf16(input_filename).c_str(), std::ios_base::binary));
 #else
   auto input_stream_istr = std::unique_ptr<std::istream>(new std::ifstream(input_filename, std::ios_base::binary));
@@ -1241,7 +1241,7 @@ void HeifFile::set_auxC_property(heif_item_id id, const std::string& type)
   m_ipma_box->add_property_for_item_ID(id, Box_ipma::PropertyAssociation{true, uint16_t(index + 1)});
 }
 
-#if defined(__MINGW32__) || defined(__MINGW64__) || defined(_MSC_VER)
+#ifdef _MSC_VER
 std::wstring HeifFile::convert_utf8_path_to_utf16(std::string str)
 {
   std::wstring ret;
diff --git a/libheif/file.h b/libheif/file.h
index 16376ad0..25db0bc1 100644
--- a/libheif/file.h
+++ b/libheif/file.h
@@ -232,7 +232,7 @@ public:
 
   void set_auxC_property(heif_item_id id, const std::string& type);
 
-#if defined(__MINGW32__) || defined(__MINGW64__) || defined(_MSC_VER)
+#ifdef _MSC_VER
   static std::wstring convert_utf8_path_to_utf16(std::string pathutf8);
 #endif
 
-- 
2.52.0

