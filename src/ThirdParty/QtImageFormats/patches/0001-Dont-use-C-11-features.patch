From 71c9619589e68906f7b4aa91e66378d81d1b78dd Mon Sep 17 00:00:00 2001
From: Peter Zhigalov <peter.zhigalov@gmail.com>
Date: Sat, 10 Mar 2018 15:40:08 +0700
Subject: [PATCH 1/7] Dont use C++11 features

---
 src/plugins/imageformats/dds/qddshandler.h    | 16 ++++----
 .../imageformats/icns/qicnshandler_p.h        | 16 ++++----
 src/plugins/imageformats/jp2/qjp2handler_p.h  | 12 +++---
 src/plugins/imageformats/mng/qmnghandler_p.h  | 24 ++++++------
 src/plugins/imageformats/tga/qtgafile.cpp     | 10 ++---
 src/plugins/imageformats/tga/qtgahandler.h    | 10 ++---
 .../imageformats/tiff/qtiffhandler.cpp        | 18 ++++-----
 .../imageformats/tiff/qtiffhandler_p.h        | 38 +++++++++----------
 .../imageformats/wbmp/qwbmphandler_p.h        | 10 ++---
 .../imageformats/webp/qwebphandler_p.h        | 22 +++++------
 10 files changed, 88 insertions(+), 88 deletions(-)

diff --git a/src/plugins/imageformats/dds/qddshandler.h b/src/plugins/imageformats/dds/qddshandler.h
index e8a98ace..e93ec1d2 100644
--- a/src/plugins/imageformats/dds/qddshandler.h
+++ b/src/plugins/imageformats/dds/qddshandler.h
@@ -19,16 +19,16 @@ class QDDSHandler : public QImageIOHandler
 public:
     QDDSHandler();
 
-    bool canRead() const override;
-    bool read(QImage *image) override;
-    bool write(const QImage &image) override;
+    bool canRead() const Q_DECL_OVERRIDE;
+    bool read(QImage *image) Q_DECL_OVERRIDE;
+    bool write(const QImage &image) Q_DECL_OVERRIDE;
 
-    QVariant option(QImageIOHandler::ImageOption option) const override;
-    void setOption(ImageOption option, const QVariant &value) override;
-    bool supportsOption(QImageIOHandler::ImageOption option) const override;
+    QVariant option(QImageIOHandler::ImageOption option) const Q_DECL_OVERRIDE;
+    void setOption(ImageOption option, const QVariant &value) Q_DECL_OVERRIDE;
+    bool supportsOption(QImageIOHandler::ImageOption option) const Q_DECL_OVERRIDE;
 
-    int imageCount() const override;
-    bool jumpToImage(int imageNumber) override;
+    int imageCount() const Q_DECL_OVERRIDE;
+    bool jumpToImage(int imageNumber) Q_DECL_OVERRIDE;
 
     static bool canRead(QIODevice *device);
 
diff --git a/src/plugins/imageformats/icns/qicnshandler_p.h b/src/plugins/imageformats/icns/qicnshandler_p.h
index 43538a4c..b5c83d4b 100644
--- a/src/plugins/imageformats/icns/qicnshandler_p.h
+++ b/src/plugins/imageformats/icns/qicnshandler_p.h
@@ -93,16 +93,16 @@ class QICNSHandler : public QImageIOHandler
 public:
     QICNSHandler();
 
-    bool canRead() const override;
-    bool read(QImage *image) override;
-    bool write(const QImage &image) override;
+    bool canRead() const Q_DECL_OVERRIDE;
+    bool read(QImage *image) Q_DECL_OVERRIDE;
+    bool write(const QImage &image) Q_DECL_OVERRIDE;
 
-    bool supportsOption(ImageOption option) const override;
-    QVariant option(ImageOption option) const override;
+    bool supportsOption(ImageOption option) const Q_DECL_OVERRIDE;
+    QVariant option(ImageOption option) const Q_DECL_OVERRIDE;
 
-    int imageCount() const override;
-    bool jumpToImage(int imageNumber) override;
-    bool jumpToNextImage() override;
+    int imageCount() const Q_DECL_OVERRIDE;
+    bool jumpToImage(int imageNumber) Q_DECL_OVERRIDE;
+    bool jumpToNextImage() Q_DECL_OVERRIDE;
 
     static bool canRead(QIODevice *device);
 
diff --git a/src/plugins/imageformats/jp2/qjp2handler_p.h b/src/plugins/imageformats/jp2/qjp2handler_p.h
index 035eaab0..dd1511d2 100644
--- a/src/plugins/imageformats/jp2/qjp2handler_p.h
+++ b/src/plugins/imageformats/jp2/qjp2handler_p.h
@@ -24,12 +24,12 @@ public:
     QJp2Handler();
     ~QJp2Handler();
     static bool canRead(QIODevice *iod, QByteArray *subType);
-    bool canRead() const override;
-    bool read(QImage *image) override;
-    bool write(const QImage &image) override;
-    QVariant option(ImageOption option) const override;
-    void setOption(ImageOption option, const QVariant &value) override;
-    bool supportsOption(ImageOption option) const override;
+    bool canRead() const Q_DECL_OVERRIDE;
+    bool read(QImage *image) Q_DECL_OVERRIDE;
+    bool write(const QImage &image) Q_DECL_OVERRIDE;
+    QVariant option(ImageOption option) const Q_DECL_OVERRIDE;
+    void setOption(ImageOption option, const QVariant &value) Q_DECL_OVERRIDE;
+    bool supportsOption(ImageOption option) const Q_DECL_OVERRIDE;
 
 private:
     Q_DECLARE_PRIVATE(QJp2Handler)
diff --git a/src/plugins/imageformats/mng/qmnghandler_p.h b/src/plugins/imageformats/mng/qmnghandler_p.h
index ea208a59..7ab48717 100644
--- a/src/plugins/imageformats/mng/qmnghandler_p.h
+++ b/src/plugins/imageformats/mng/qmnghandler_p.h
@@ -22,19 +22,19 @@ class QMngHandler : public QImageIOHandler
     public:
     QMngHandler();
     ~QMngHandler();
-    bool canRead() const override;
-    bool read(QImage *image) override;
-    bool write(const QImage &image) override;
-    int currentImageNumber() const override;
-    int imageCount() const override;
-    bool jumpToImage(int imageNumber) override;
-    bool jumpToNextImage() override;
-    int loopCount() const override;
-    int nextImageDelay() const override;
+    bool canRead() const Q_DECL_OVERRIDE;
+    bool read(QImage *image) Q_DECL_OVERRIDE;
+    bool write(const QImage &image) Q_DECL_OVERRIDE;
+    int currentImageNumber() const Q_DECL_OVERRIDE;
+    int imageCount() const Q_DECL_OVERRIDE;
+    bool jumpToImage(int imageNumber) Q_DECL_OVERRIDE;
+    bool jumpToNextImage() Q_DECL_OVERRIDE;
+    int loopCount() const Q_DECL_OVERRIDE;
+    int nextImageDelay() const Q_DECL_OVERRIDE;
     static bool canRead(QIODevice *device);
-    QVariant option(ImageOption option) const override;
-    void setOption(ImageOption option, const QVariant & value) override;
-    bool supportsOption(ImageOption option) const override;
+    QVariant option(ImageOption option) const Q_DECL_OVERRIDE;
+    void setOption(ImageOption option, const QVariant & value) Q_DECL_OVERRIDE;
+    bool supportsOption(ImageOption option) const Q_DECL_OVERRIDE;
 
     private:
     Q_DECLARE_PRIVATE(QMngHandler)
diff --git a/src/plugins/imageformats/tga/qtgafile.cpp b/src/plugins/imageformats/tga/qtgafile.cpp
index 54bfe95b..a1e3ec24 100644
--- a/src/plugins/imageformats/tga/qtgafile.cpp
+++ b/src/plugins/imageformats/tga/qtgafile.cpp
@@ -15,7 +15,7 @@ struct TgaReader
 {
     Q_DISABLE_COPY(TgaReader)
 
-    TgaReader() = default;
+    TgaReader() {}
 
     virtual ~TgaReader() {}
     virtual QRgb operator()(QIODevice *s) const = 0;
@@ -24,7 +24,7 @@ struct TgaReader
 struct Tga16Reader : public TgaReader
 {
     ~Tga16Reader() {}
-    QRgb operator()(QIODevice *s) const override
+    QRgb operator()(QIODevice *s) const Q_DECL_OVERRIDE
     {
         char ch1, ch2;
         if (s->getChar(&ch1) && s->getChar(&ch2)) {
@@ -40,7 +40,7 @@ struct Tga16Reader : public TgaReader
 
 struct Tga24Reader : public TgaReader
 {
-    QRgb operator()(QIODevice *s) const override
+    QRgb operator()(QIODevice *s) const Q_DECL_OVERRIDE
     {
         char r, g, b;
         if (s->getChar(&b) && s->getChar(&g) && s->getChar(&r))
@@ -52,7 +52,7 @@ struct Tga24Reader : public TgaReader
 
 struct Tga32Reader : public TgaReader
 {
-    QRgb operator()(QIODevice *s) const override
+    QRgb operator()(QIODevice *s) const Q_DECL_OVERRIDE
     {
         char r, g, b, a;
         if (s->getChar(&b) && s->getChar(&g) && s->getChar(&r) && s->getChar(&a))
@@ -198,7 +198,7 @@ QImage QTgaFile::readImage()
             cmapDepth = 16;
         if (cmapDepth != 16 && cmapDepth != 24 && cmapDepth != 32) {
             mErrorMessage = tr("Invalid color map depth (%1)").arg(cmapDepth);
-            return {};
+            return QImage();
         }
         offset += littleEndianInt(&mHeader[CMapLength]) * cmapDepth / 8;
     }
diff --git a/src/plugins/imageformats/tga/qtgahandler.h b/src/plugins/imageformats/tga/qtgahandler.h
index f002dc18..28b8cc2a 100644
--- a/src/plugins/imageformats/tga/qtgahandler.h
+++ b/src/plugins/imageformats/tga/qtgahandler.h
@@ -18,14 +18,14 @@ public:
     QTgaHandler();
     ~QTgaHandler();
 
-    bool canRead() const override;
-    bool read(QImage *image) override;
+    bool canRead() const Q_DECL_OVERRIDE;
+    bool read(QImage *image) Q_DECL_OVERRIDE;
 
     static bool canRead(QIODevice *device);
 
-    QVariant option(ImageOption option) const override;
-    void setOption(ImageOption option, const QVariant &value) override;
-    bool supportsOption(ImageOption option) const override;
+    QVariant option(ImageOption option) const Q_DECL_OVERRIDE;
+    void setOption(ImageOption option, const QVariant &value) Q_DECL_OVERRIDE;
+    bool supportsOption(ImageOption option) const Q_DECL_OVERRIDE;
 
 private:
     mutable QTgaFile *tga;
diff --git a/src/plugins/imageformats/tiff/qtiffhandler.cpp b/src/plugins/imageformats/tiff/qtiffhandler.cpp
index 1f1191cd..c9304037 100644
--- a/src/plugins/imageformats/tiff/qtiffhandler.cpp
+++ b/src/plugins/imageformats/tiff/qtiffhandler.cpp
@@ -71,7 +71,7 @@ int qtiffMapProc(thandle_t fd, void **base, toff_t *size)
     QFileDevice *file = qobject_cast<QFileDevice *>(device);
     if (file) {
         *base = file->map(0, file->size());
-        if (*base != nullptr) {
+        if (*base != Q_NULLPTR) {
             *size = file->size();
             return 1;
         }
@@ -175,7 +175,7 @@ static int qt2Exif(QImageIOHandler::Transformations transformation)
 
 QTiffHandlerPrivate::QTiffHandlerPrivate()
     : tiff(0)
-    , compression(QTiffHandler::Compression::None)
+    , compression(QTiffHandler::Compression_None)
     , transformation(QImageIOHandler::TransformationNone)
     , format(QImage::Format_Invalid)
     , photometric(false)
@@ -292,7 +292,7 @@ bool QTiffHandlerPrivate::openForRead(QIODevice *device)
         return false;
 
     tiff = openInternal("rh", device);
-    return tiff != nullptr;
+    return tiff != Q_NULLPTR;
 }
 
 bool QTiffHandlerPrivate::readHeaders(QIODevice *device)
@@ -1170,17 +1170,17 @@ bool QTiffHandler::ensureHaveDirectoryCount() const
 int QTiffHandler::toLibTiffCompression(Compression compression) const
 {
     switch (compression) {
-    case Compression::None:
+    case Compression_None:
         return COMPRESSION_NONE;
-    case Compression::Lzw:
+    case Compression_Lzw:
         return COMPRESSION_LZW;
-    case Compression::HuffmanRLE:
+    case Compression_HuffmanRLE:
         return COMPRESSION_CCITTRLE;
-    case Compression::Group3:
+    case Compression_Group3:
         return COMPRESSION_CCITTFAX3;
-    case Compression::Group4:
+    case Compression_Group4:
         return COMPRESSION_CCITTFAX4;
-    case Compression::Jpeg:
+    case Compression_Jpeg:
         return COMPRESSION_JPEG;
     }
     qCWarning(lcTiff, "Invalid compression value (%d)", int(compression));
diff --git a/src/plugins/imageformats/tiff/qtiffhandler_p.h b/src/plugins/imageformats/tiff/qtiffhandler_p.h
index f62de077..0067102d 100644
--- a/src/plugins/imageformats/tiff/qtiffhandler_p.h
+++ b/src/plugins/imageformats/tiff/qtiffhandler_p.h
@@ -17,28 +17,28 @@ class QTiffHandler : public QImageIOHandler
 public:
     QTiffHandler();
 
-    bool canRead() const override;
-    bool read(QImage *image) override;
-    bool write(const QImage &image) override;
+    bool canRead() const Q_DECL_OVERRIDE;
+    bool read(QImage *image) Q_DECL_OVERRIDE;
+    bool write(const QImage &image) Q_DECL_OVERRIDE;
 
     static bool canRead(QIODevice *device);
 
-    QVariant option(ImageOption option) const override;
-    void setOption(ImageOption option, const QVariant &value) override;
-    bool supportsOption(ImageOption option) const override;
-
-    bool jumpToNextImage() override;
-    bool jumpToImage(int imageNumber) override;
-    int imageCount() const override;
-    int currentImageNumber() const override;
-
-    enum class Compression {
-        None = 0,
-        Lzw = 1,
-        HuffmanRLE = 2,
-        Group3 = 3,
-        Group4 = 4,
-        Jpeg = 5
+    QVariant option(ImageOption option) const Q_DECL_OVERRIDE;
+    void setOption(ImageOption option, const QVariant &value) Q_DECL_OVERRIDE;
+    bool supportsOption(ImageOption option) const Q_DECL_OVERRIDE;
+
+    bool jumpToNextImage() Q_DECL_OVERRIDE;
+    bool jumpToImage(int imageNumber) Q_DECL_OVERRIDE;
+    int imageCount() const Q_DECL_OVERRIDE;
+    int currentImageNumber() const Q_DECL_OVERRIDE;
+
+    enum Compression {
+        Compression_None = 0,
+        Compression_Lzw = 1,
+        Compression_HuffmanRLE = 2,
+        Compression_Group3 = 3,
+        Compression_Group4 = 4,
+        Compression_Jpeg = 5
     };
 private:
     void convert32BitOrder(void *buffer, int width);
diff --git a/src/plugins/imageformats/wbmp/qwbmphandler_p.h b/src/plugins/imageformats/wbmp/qwbmphandler_p.h
index ea5b628e..74a9ed76 100644
--- a/src/plugins/imageformats/wbmp/qwbmphandler_p.h
+++ b/src/plugins/imageformats/wbmp/qwbmphandler_p.h
@@ -29,12 +29,12 @@ public:
     QWbmpHandler(QIODevice *device);
     ~QWbmpHandler();
 
-    bool canRead() const override;
-    bool read(QImage *image) override;
-    bool write(const QImage &image) override;
+    bool canRead() const Q_DECL_OVERRIDE;
+    bool read(QImage *image) Q_DECL_OVERRIDE;
+    bool write(const QImage &image) Q_DECL_OVERRIDE;
 
-    QVariant option(ImageOption option) const override;
-    bool supportsOption(ImageOption option) const override;
+    QVariant option(ImageOption option) const Q_DECL_OVERRIDE;
+    bool supportsOption(ImageOption option) const Q_DECL_OVERRIDE;
 
     static bool canRead(QIODevice *device);
 
diff --git a/src/plugins/imageformats/webp/qwebphandler_p.h b/src/plugins/imageformats/webp/qwebphandler_p.h
index a52ebc57..b993f27c 100644
--- a/src/plugins/imageformats/webp/qwebphandler_p.h
+++ b/src/plugins/imageformats/webp/qwebphandler_p.h
@@ -25,21 +25,21 @@ public:
     ~QWebpHandler();
 
 public:
-    bool canRead() const override;
-    bool read(QImage *image) override;
+    bool canRead() const Q_DECL_OVERRIDE;
+    bool read(QImage *image) Q_DECL_OVERRIDE;
 
     static bool canRead(QIODevice *device);
 
-    bool write(const QImage &image) override;
-    QVariant option(ImageOption option) const override;
-    void setOption(ImageOption option, const QVariant &value) override;
-    bool supportsOption(ImageOption option) const override;
+    bool write(const QImage &image) Q_DECL_OVERRIDE;
+    QVariant option(ImageOption option) const Q_DECL_OVERRIDE;
+    void setOption(ImageOption option, const QVariant &value) Q_DECL_OVERRIDE;
+    bool supportsOption(ImageOption option) const Q_DECL_OVERRIDE;
 
-    int imageCount() const override;
-    int currentImageNumber() const override;
-    QRect currentImageRect() const override;
-    int loopCount() const override;
-    int nextImageDelay() const override;
+    int imageCount() const Q_DECL_OVERRIDE;
+    int currentImageNumber() const Q_DECL_OVERRIDE;
+    QRect currentImageRect() const Q_DECL_OVERRIDE;
+    int loopCount() const Q_DECL_OVERRIDE;
+    int nextImageDelay() const Q_DECL_OVERRIDE;
 
 private:
     bool ensureScanned() const;
-- 
2.47.3

